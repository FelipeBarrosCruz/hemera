<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Pattern matching · Hemera</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Hemera provides two different ways to index your pattern efficiently. This functionality is provided by the &lt;a href=&quot;https://github.com/mcollina/bloomrun&quot;&gt;Bloomrun&lt;/a&gt; package a js pattern matcher with results that can be returned in &lt;code&gt;insertion&lt;/code&gt; order or &lt;code&gt;depth&lt;/code&gt; order. Inspired by bloom filters.&lt;/p&gt;
"/><meta name="docsearch:version" content="6.0.1"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Pattern matching · Hemera"/><meta property="og:type" content="website"/><meta property="og:url" content="https://hemerajs.github.io/hemera//hemera/index.html"/><meta property="og:description" content="&lt;p&gt;Hemera provides two different ways to index your pattern efficiently. This functionality is provided by the &lt;a href=&quot;https://github.com/mcollina/bloomrun&quot;&gt;Bloomrun&lt;/a&gt; package a js pattern matcher with results that can be returned in &lt;code&gt;insertion&lt;/code&gt; order or &lt;code&gt;depth&lt;/code&gt; order. Inspired by bloom filters.&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/hemera/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"/><link rel="alternate" type="application/atom+xml" href="https://hemerajs.github.io/hemera//hemera/blog/atom.xml" title="Hemera Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://hemerajs.github.io/hemera//hemera/blog/feed.xml" title="Hemera Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-115960465-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/hemera/css/main.css"/><script src="/hemera/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/hemera/"><img class="logo" src="/hemera/img/hemera-tiny.png" alt="Hemera"/><h2 class="headerTitleWithLogo">Hemera</h2></a><a href="/hemera/versions.html"><h3>6.0.1</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/hemera/docs/6.0.1/what-is-hemera.html" target="_self">Docs</a></li><li class=""><a href="/hemera/help.html" target="_self">Help</a></li><li class=""><a href="/hemera/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/hemerajs/hemera" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Basics</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/what-is-hemera.html">What is Hemera?</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/installation.html">Installation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Basics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/request-reply.html">Request &amp; Reply</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/hemera/docs/6.0.1/pattern-matching.html">Pattern matching</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/publish-susbcribe.html">Publish &amp; Subscribe</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/payload-validation.html">Payload validation</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/middleware.html">Middleware</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/extension.html">Extension</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/logging.html">Logging</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/decorator.html">Decorators</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/event.html">Events</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/codec.html">Codec</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/config.html">Config</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Context</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/metadata.html">Metadata</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/context.html">Context</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/delegate.html">Delegate</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/trace.html">Trace</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/request.html">Request</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Plugins</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/ecosystem.html">Ecosystem</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/plugin.html">Plugin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Error handling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/error-handling.html">Introduction</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/error-serialization.html">Serialization</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/notfoundPattern.html">Not found pattern</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/timeout.html">Timeouts</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/fatal.html">Fatal</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/propagation.html">Propagation</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/error-event.html">Events</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/protection.html">Protection</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Testing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/integration.html">Integration</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/unit.html">Unit</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tooling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/monitoring.html">Monitoring</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/cli.html">Cli</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/typescript.html">Typescript</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/message-format.html">Message format</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/docker.html">Docker</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/graphql.html">GraphQL</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/bridge.html">Bridge</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/clustering.html">Clustering</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/api-versioning.html">Api versioning</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/nats-limit.html">NATS characteristics</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/framework-integrations.html">Framework integrations</a></li><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/hemera-vs-seneca.html">Hemera Vs Seneca</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/hemera/docs/6.0.1/reference.html">Reference</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Pattern matching</h1></header><article><div><span><p>Hemera provides two different ways to index your pattern efficiently. This functionality is provided by the <a href="https://github.com/mcollina/bloomrun">Bloomrun</a> package a js pattern matcher with results that can be returned in <code>insertion</code> order or <code>depth</code> order. Inspired by bloom filters.</p>
<h2><a class="anchor" aria-hidden="true" id="insertion-order"></a><a href="#insertion-order" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Insertion order</h2>
<p>By default all patterns are indexed in insertion order.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> hemera = <span class="hljs-keyword">new</span> Hemera({
  <span class="hljs-attr">bloomrun</span>: {
    <span class="hljs-attr">indexing</span>: <span class="hljs-string">'insertion'</span>
  }
})

<span class="hljs-comment">// Matched</span>
hemera.add(
  {
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'service'</span>,
    <span class="hljs-attr">cmd</span>: <span class="hljs-string">'a'</span>
  },
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, cb</span>) </span>{
    cb(<span class="hljs-literal">null</span>, <span class="hljs-number">1</span>)
  }
)

hemera.add(
  {
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'service'</span>,
    <span class="hljs-attr">cmd</span>: <span class="hljs-string">'a'</span>,
    <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>
  },
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, cb</span>) </span>{
    cb(<span class="hljs-literal">null</span>, <span class="hljs-number">2</span>)
  }
)
hemera.act({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'service'</span>,
  <span class="hljs-attr">cmd</span>: <span class="hljs-string">'a'</span>,
  <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>
}) <span class="hljs-comment">// return 1</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="depth-order"></a><a href="#depth-order" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Depth order</h2>
<p>Depth indexing provides you more flexibility.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> hemera = <span class="hljs-keyword">new</span> Hemera({
  <span class="hljs-attr">bloomrun</span>: {
    <span class="hljs-attr">indexing</span>: <span class="hljs-string">'depth'</span>
  }
})

hemera.add(
  {
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'service'</span>,
    <span class="hljs-attr">cmd</span>: <span class="hljs-string">'a'</span>
  },
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, cb</span>) </span>{
    cb(<span class="hljs-literal">null</span>, <span class="hljs-number">1</span>)
  }
)

<span class="hljs-comment">// Matched</span>
hemera.add(
  {
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'service'</span>,
    <span class="hljs-attr">cmd</span>: <span class="hljs-string">'a'</span>,
    <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>
  },
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, cb</span>) </span>{
    cb(<span class="hljs-literal">null</span>, <span class="hljs-number">2</span>)
  }
)
hemera.act({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'service'</span>,
  <span class="hljs-attr">cmd</span>: <span class="hljs-string">'a'</span>,
  <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>
}) <span class="hljs-comment">// return 2</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="what-s-a-pattern"></a><a href="#what-s-a-pattern" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What's a pattern?</h2>
<p>Any javascript object with the combination of properties from type <code>boolean</code>, <code>string</code>, <code>regex</code> and <code>numbers</code>. Any other type like e.g <code>object</code> will be handled as payload. For more informations look in the <a href="https://github.com/mcollina/bloomrun">Bloomrun</a> package.</p>
<h2><a class="anchor" aria-hidden="true" id="pattern-definition"></a><a href="#pattern-definition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pattern definition</h2>
<p>You can define a pattern in two different ways:</p>
<ul>
<li><p>As JSON Object</p>
<pre><code class="hljs css language-js">hemera.add(
  {
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'math'</span>,
    <span class="hljs-attr">cmd</span>: <span class="hljs-string">'add'</span>
  },
  (req, cb) =&gt; {
    cb(<span class="hljs-literal">null</span>, req.a + req.b)
  }
)
hemera.act({
  <span class="hljs-attr">topic</span>: math,
  <span class="hljs-attr">cmd</span>: add,
  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>
})
</code></pre></li>
<li><p>As quick syntax JSON Object provided by <a href="https://github.com/mcollina/tinysonic">tinysonic</a> package.</p>
<pre><code class="hljs css language-js">hemera.add(<span class="hljs-string">'topic:math,cmd:add'</span>, (req, cb) =&gt; {
  cb(<span class="hljs-literal">null</span>, req.a + req.b)
})
hemera.act(<span class="hljs-string">'topic:math,cmd:add,a:1,b:2'</span>)
</code></pre></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="hemera-properties"></a><a href="#hemera-properties" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hemera $ properties</h2>
<p>In Hemera we use special <code>$</code> suffixed properties to configure additional transport options in NATS or to pass informations to configure plugins. Please consider that those properties are not part of the pattern and will be ingored at pattern matching. They won't be send.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/hemera/docs/6.0.1/request-reply.html"><span class="arrow-prev">← </span><span>Request &amp; Reply</span></a><a class="docs-next button" href="/hemera/docs/6.0.1/publish-susbcribe.html"><span>Publish &amp; Subscribe</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/hemera/" class="nav-home"><img src="/hemera/img/hemera-blackwhite.png" alt="Hemera" width="66" height="58"/></a><div><h5>Docs</h5><a href="/hemera/docs/installation.html">Getting Started</a><a href="/hemera/docs/plugin.html">Create a plugin</a><a href="/hemera/docs/api.html">API Reference</a></div><div><h5>Community</h5><a href="/hemera/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/hemera" target="_blank">Stack Overflow</a><a href="https://gitter.im/hemerajs/hemera">Gitter Chat</a><a href="https://twitter.com/hemerajs" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/hemera/blog">Blog</a><a href="https://github.com/hemerajs/hemera">GitHub</a><a class="github-button" href="https://github.com/hemerajs/hemera/" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Hemera.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5620e631e688fee9d15ed89f7d258f1a',
                indexName: 'hemerajs',
                inputSelector: '#search_input_react'
              });
            </script></body></html>